<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz: Metodología – Guía de Observación</title>
  <style>
    :root{
      --bg:#1a1a2e; --card:#0f0f23; --ink:#ffff00; --muted:#ff69b4;
      --accent:#ff69b4; --accent-2:#00bfff; --danger:#ff1493; --ok:#00ff00; --warn:#ffff00;
      --gold:#ffff00; --violet:#ff69b4; --pink:#ff69b4; --sky:#00bfff;
      --pacman-yellow:#ffff00; --pacman-pink:#ff69b4; --pacman-blue:#00bfff; --pacman-green:#00ff00;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;color:var(--ink);background:
      radial-gradient(1200px 800px at 80% -10%, #ffff0022, transparent),
      radial-gradient(1400px 900px at 0% 110%, #ff69b411, transparent),
      radial-gradient(800px 600px at 50% 50%, #00bfff15, transparent),
      linear-gradient(180deg, #1a1a2e 0%, #0f0f23 50%, #1a1a2e 100%);
      display:flex;align-items:stretch;justify-content:center;padding:24px}
    .app{width:min(980px,100%);margin:auto}
    .header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:12px;background:conic-gradient(from 220deg,#ffff00,#ff69b4 35%,#00bfff 70%,#00ff00);box-shadow:0 10px 30px rgba(255,255,0,0.4);position:relative}
    .logo:after{content:"";position:absolute;inset:6px;border-radius:10px;background:radial-gradient(circle at 30% 30%,#fff8,transparent 40%),#ffff00;mix-blend:overlay}
    h1{font-size:clamp(1.1rem,2vw + .6rem,1.6rem);margin:0;color:var(--ink);text-shadow:1px 1px 2px rgba(255,255,255,0.5)}
    .muted{color:var(--muted);font-size:.9rem}
    .card{background:linear-gradient(180deg,#0f0f23,#0f0f23dd 60%,#0f0f2380);border:2px solid #ffff00;border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(255,255,0,0.3)}

    .hud{display:grid;grid-template-columns:1.1fr auto auto auto;gap:10px;align-items:center}
    .pill{all:unset;cursor:pointer;padding:10px 14px;border-radius:999px;background:#00bfff;border:2px solid #ffff00;color:#1a1a2e;font-weight:600}
    .pill.primary{background:linear-gradient(135deg,#ff69b4,#ff1493);color:#ffff00;border:2px solid #ffff00;font-weight:700}
    .pill.warn{background:linear-gradient(135deg,#ffff00,#ffd700);color:#1a1a2e;border:2px solid #ff69b4;font-weight:700}

    .stat{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:linear-gradient(135deg,#00bfff,#0080ff);border:2px solid #ffff00;color:#1a1a2e}
    .stat .v{font-weight:700;color:#1a1a2e}
    .life{color:#ff69b4;font-weight:700}
    .xp{color:#00ff00;font-weight:700}
    .streak{color:#ffff00;font-weight:700}

    .q-card{margin:14px 0;position:relative;background:linear-gradient(135deg,#ff69b4,#ff1493);border:3px solid #ffff00;border-radius:20px;padding:24px;box-shadow:0 8px 32px rgba(255,105,180,0.4), 0 0 0 1px #ffff00}
    .q-title{font-weight:700;line-height:1.4;font-size:1.1rem;color:#1a1a2e;margin-bottom:16px;padding:16px;background:linear-gradient(135deg,#ffff00,#ffd700);border-radius:12px;border-left:6px solid #ff69b4;text-shadow:1px 1px 2px rgba(255,255,255,0.3)}
    .options{margin-top:16px;display:grid;gap:12px}
    button.option{all:unset;display:flex;gap:12px;align-items:flex-start;cursor:pointer;border:2px solid #ffff00;background:linear-gradient(135deg,#00bfff,#0080ff);padding:16px 18px;border-radius:14px;line-height:1.4;position:relative;transition:all .2s ease;font-size:1rem;color:#1a1a2e;text-shadow:1px 1px 2px rgba(255,255,255,0.3)}
    button.option:hover{transform:translateY(-2px);border-color:#ffff00;background:linear-gradient(135deg,#00ff00,#00cc00);box-shadow:0 4px 16px rgba(0,255,0,0.4);color:#1a1a2e}
    button.option.correct{border-color:#10b981;background:linear-gradient(180deg,#0f1f2a,#0f2a1a)}
    button.option.wrong{border-color:#ef4444;background:linear-gradient(180deg,#2a0f0f,#1a0f0f)}
    .badge{min-width:32px;height:32px;border-radius:12px;display:inline-grid;place-items:center;font-weight:800;font-size:.9rem;color:#1a1a2e;background:linear-gradient(135deg,#ffff00,#ffd700);border:2px solid #ff69b4;box-shadow:0 2px 8px rgba(255,255,0,0.4);text-shadow:1px 1px 2px rgba(255,255,255,0.3)}
    .feedback{margin-top:10px;padding:10px 12px;border-radius:12px;background:#0e1535;border:1px dashed #2a3566}
    .feedback.ok{border-color:#065f46;background:#0b2a20}
    .feedback.err{border-color:#7f1d1d;background:#2a0b0b}

    .timer{height:12px;background:rgba(15,15,35,0.3);border:2px solid #ffff00;border-radius:999px;overflow:hidden;margin-top:12px;backdrop-filter:blur(10px)}
    .timer .bar{height:100%;width:100%;background:linear-gradient(90deg,#ffff00,#ff69b4);transition:width .25s linear}

    .progress{margin-top:10px;height:10px;background:rgba(15,15,35,0.3);border:2px solid #ffff00;border-radius:999px;overflow:hidden;backdrop-filter:blur(10px)}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#00ff00,#00bfff)}
    .score{font-weight:800}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:700px){.grid{grid-template-columns:1fr}}

    /* Badges */
    .badges{display:flex;gap:8px;flex-wrap:wrap}
    .badge-chip{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:2px solid #fbbf24;background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:#fef3c7;font-weight:600}

    /* Modals */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,0.8)}
    .modal.show{display:grid}
    .modal .panel{background:linear-gradient(135deg,#16213e,#1a1a2e);border:2px solid #fbbf24;border-radius:16px;padding:18px;max-width:min(680px,92%);color:#fef3c7}

    /* Confetti */
    .confetti{pointer-events:none;position:fixed;inset:0;overflow:hidden}
    .piece{position:absolute;width:10px;height:16px;will-change:transform,opacity;opacity:.95;border-radius:2px}
    @keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:.98}}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Quiz: Metodología – Guía de Observación</h1>
          <div class="muted"> ✨</div>
        </div>
      </div>
      <button class="pill" id="btnHow">¿Cómo jugar?</button>
    </div>

    <div class="card" id="quiz"></div>


    <div class="card hud">
      <div class="stat"><span>✅ Correctas:</span><span class="v" id="statCorrect">0</span>/<span id="statTotal">0</span></div>
      <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end">
        <button class="pill primary" id="btnReset">Reiniciar</button>
        <button class="pill warn" id="btnShuffle">Barajar preguntas</button>
      </div>
    </div>
  </div>

  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <div class="modal" id="modalHow">
    <div class="panel">
      <h3>Cómo jugar</h3>
      <ul>
        <li>Lee cada pregunta y selecciona tu respuesta.</li>
        <li>Ve el feedback y la explicación de la respuesta correcta.</li>
        <li>Haz clic en <b>"Siguiente"</b> cuando estés listo para continuar.</li>
        <li>Puedes <b>barajar</b> el orden de las preguntas y <b>reiniciar</b> cuando quieras.</li>
        <li>¡Disfruta del confetti cuando aciertes! ✨</li>
      </ul>
      <div style="display:flex;justify-content:flex-end"><button class="pill primary" id="closeHow">¡A jugar!</button></div>
    </div>
  </div>

  <div class="modal" id="modalEnd">
    <div class="panel">
      <h3>¡Quiz completado!</h3>
      <p><span id="summary"></span></p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
        <button class="pill" id="again">Volver a intentar</button>
        <button class="pill primary" id="shuffleAgain">Reiniciar + Barajar</button>
      </div>
    </div>
  </div>

  <script>
  // ---------- Sonidos simples ----------
  const SFX = {
    on: true,
    beep(ok=true){ if(!this.on) return; const ctx = SFX.ctx || (SFX.ctx = new (window.AudioContext||window.webkitAudioContext)()); const o = ctx.createOscillator(); const g = ctx.createGain(); o.type='sine'; o.frequency.value = ok? 880: 220; g.gain.setValueAtTime(0.0001, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.08, ctx.currentTime+0.02); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25); o.connect(g).connect(ctx.destination); o.start(); o.stop(ctx.currentTime+0.26); }
  }

  // ---------- Banco de preguntas (Metodología) ----------
  const QUESTIONS_BASE = [
    { type:'mc', title:'En la guía, “form, meaning, use” (forma, significado, uso) se refiere a…', options:['Cómo se planifica la clase.','Los tres enfoques para enseñar gramática.','Los pasos de una transición.','Los tipos de retroalimentación.'], correct:1, explain:'“Form–Meaning–Use” son tres dimensiones para la gramática: forma (cómo se escribe/pronuncia), significado (para qué sirve) y uso (cuándo/cómo en contexto).', tag:'gram' },
    { type:'mc', title:'Si un estudiante responde un cuestionario de comprensión tras leer un texto, la habilidad evaluada es…', options:['Escritura','Lectura','Gramática','Habla'], correct:1, explain:'Se codifica como “lectura”; la escritura es un medio para responder, no el objetivo de la tarea.', tag:'skills' },
    { type:'mc', title:'Una actividad donde los estudiantes crean un póster con información personal corresponde a…', options:['Recordar','Comprender','Crear','Evaluar'], correct:2, explain:'Elaborar un producto original → nivel "Crear" (Taxonomía de Bloom).', tag:'bloom' },
    { type:'mc', title:'En Taxonomía de Bloom, pedir que comparen dos tradiciones culturales corresponde a…', options:['Analizar','Aplicar','Recordar','Evaluar'], correct:0, explain:'Comparar/contrastar establece relaciones → "Analizar".', tag:'bloom' },
    { type:'mc', title:'Una transición completa entre tareas debe incluir…', options:['Silencio total antes de iniciar.','Anunciar fin, presentar la siguiente e instrucciones claras.','Entrega de material anterior.','Explicar la planeación por escrito.'], correct:1, explain:'Cerrar explícitamente, anunciar la nueva tarea e indicar instrucciones claras evita tiempos muertos.', tag:'trans' },
    { type:'tf', title:'Si en una tarea de lectura responden preguntas de comprensión, se marca lectura y escritura.', correct:false, explain:'Falso: solo “lectura”; la escritura es un medio.', tag:'skills' },
    { type:'tf', title:'El Aprendizaje Basado en Proyectos promueve motivación intrínseca y producto final.', correct:true, explain:'Verdadero: PBL centra al estudiante, fomenta colaboración y culmina con un producto.', tag:'meth' },
    { type:'tf', title:'Un role play de pedir comida trabaja hablar (speaking) y “aplicar”.', correct:true, explain:'Verdadero: uso funcional del lenguaje → “Aplicar”.', tag:'bloom' },
    { type:'tf', title:'Un warm-up o una explicación del docente cuentan como “tareas” para codificar procesos cognitivos.', correct:false, explain:'Falso: la tarea debe involucrar a estudiantes con inicio–desarrollo–cierre y comprobación.', tag:'bloom' },
    { type:'tf', title:'CLIL consiste en enseñar gramática explícita antes de un contenido.', correct:false, explain:'Falso: CLIL = aprender lengua a través de contenidos (ciencias, geografía), priorizando la comunicación.', tag:'meth' }
  ];

  // ---------- Estado simplificado ----------
  let QUESTIONS = [];
  let state = {
    answered: [],
    correctCount: 0,
    idx: 0
  };

  // ---------- Utilidades ----------
  const $ = sel => document.querySelector(sel);
  const elQuiz = $('#quiz');
  const elConfetti = $('#confetti');
  const statCorrect = $('#statCorrect');
  const statTotal = $('#statTotal');
  const btnReset = $('#btnReset');
  const btnShuffle = $('#btnShuffle');
  const btnHow = $('#btnHow');
  const modalHow = $('#modalHow');
  const closeHow = $('#closeHow');
  const modalEnd = $('#modalEnd');
  const summary = $('#summary');
  const again = $('#again');
  const shuffleAgain = $('#shuffleAgain');

  function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]} return a }

  function confettiBurst(nBase=28){
    const colors = ['#ffff00','#ff69b4','#00bfff','#00ff00','#ffd700','#ff1493'];
    const n = nBase + Math.floor(Math.random()*12);
    for(let i=0;i<n;i++){
      const p=document.createElement('div'); p.className='piece';
      const size=8+Math.random()*10; p.style.width=size+'px'; p.style.height=(size*1.6)+'px';
      p.style.left=(Math.random()*100)+'%'; p.style.top='-20px'; p.style.background=colors[Math.floor(Math.random()*colors.length)];
      const dx=(Math.random()*2-1)*40; const dur=1.2+Math.random()*1.2;
      p.style.animation=`fall ${dur}s linear forwards`;
      p.animate([{transform:`translate(0,-20px) rotate(0deg)`},{transform:`translate(${dx}px,85vh) rotate(${360+Math.random()*720}deg)`}],{duration:dur*1000,easing:'ease-in',fill:'forwards'});
      elConfetti.appendChild(p); setTimeout(()=>p.remove(), dur*1000+120);
    }
  }

  function reset(shuffleFirst=false){
    QUESTIONS = QUESTIONS_BASE.slice();
    if(shuffleFirst) shuffle(QUESTIONS);
    state = { answered:Array(QUESTIONS.length).fill(null), correctCount:0, idx:0 };
    statTotal.textContent = QUESTIONS.length;
    render();
    modalEnd.classList.remove('show');
  }

  function render(){
    statCorrect.textContent = state.correctCount;

    elQuiz.innerHTML='';
    const i = state.idx;
    if(i>=QUESTIONS.length){ return endGame(); }
    const q = QUESTIONS[i];

    const card = document.createElement('div'); card.className='q-card card';
    const title = document.createElement('div'); title.className='q-title'; title.innerHTML = `<span class="badge">${i+1}</span> &nbsp; ${q.title}`; card.appendChild(title);

    const opts = document.createElement('div'); opts.className='options';

    if(q.type==='mc'){
      q.options.forEach((text, idx)=>{
        const btn=document.createElement('button'); btn.className='option'; btn.innerHTML=`<div class="badge">${String.fromCharCode(65+idx)}</div><div>${text}</div>`;
        btn.addEventListener('click', ()=> answer(i, idx)); opts.appendChild(btn);
      });
    } else {
      [true,false].forEach((val)=>{ const btn=document.createElement('button'); btn.className='option'; btn.innerHTML=`<div class="badge">${val? 'V':'F'}</div><div>${val? 'Verdadero':'Falso'}</div>`; btn.addEventListener('click', ()=> answer(i, val)); opts.appendChild(btn); });
    }

    card.appendChild(opts);
    elQuiz.appendChild(card);
  }

  function answer(i, val){
    if(state.answered[i]!==null) return; // ya respondida
    const q = QUESTIONS[i];
    const correct = (q.type==='mc') ? val===q.correct : val===q.correct;

    if(correct){
      state.correctCount++;
      confettiBurst(32);
    }

    // marcar visualmente opciones
    const buttons = elQuiz.querySelectorAll('.option');
    buttons.forEach((b, idx)=>{
      if(q.type==='mc'){
        if(idx===q.correct) b.classList.add('correct');
        if(idx===val && idx!==q.correct) b.classList.add('wrong');
      } else {
        const isTrue = b.textContent.includes('Verdadero');
        const thisVal = isTrue;
        if(thisVal===q.correct) b.classList.add('correct');
        if(thisVal===val && thisVal!==q.correct) b.classList.add('wrong');
      }
      b.disabled = true;
    });

    // feedback
    const fb = document.createElement('div'); fb.className = 'feedback ' + (correct? 'ok':'err'); fb.textContent = (correct? '¡Correcto! ' : 'Respuesta incorrecta. ') + q.explain; elQuiz.querySelector('.q-card').appendChild(fb);

    // botón siguiente
    const nextBtn = document.createElement('button'); 
    nextBtn.className = 'pill primary'; 
    nextBtn.textContent = 'Siguiente →'; 
    nextBtn.style.marginTop = '16px';
    nextBtn.addEventListener('click', ()=> {
      state.answered[i]=val; 
      state.idx++; 
      render();
    });
    elQuiz.querySelector('.q-card').appendChild(nextBtn);
  }

  function endGame(){
    // Resumen simplificado
    const pct = Math.round(state.correctCount / QUESTIONS.length * 100);
    let title = pct===100? '¡Perfecto!': pct>=80? '¡Excelente!': pct>=60? '¡Bien hecho!': '¡Sigue practicando!';
    summary.innerHTML = `<b>${title}</b><br>Respuestas correctas: <b>${state.correctCount}/${QUESTIONS.length}</b> (${pct}%)`;

    modalEnd.classList.add('show');
    if(pct>=80) confettiBurst(60);
  }

  // ---------- Eventos ----------
  btnReset.addEventListener('click', ()=> reset(false));
  btnShuffle.addEventListener('click', ()=> reset(true));
  btnHow.addEventListener('click', ()=> modalHow.classList.add('show'));
  closeHow.addEventListener('click', ()=> modalHow.classList.remove('show'));
  again.addEventListener('click', ()=> { reset(false); modalEnd.classList.remove('show'); });
  shuffleAgain.addEventListener('click', ()=> { reset(true); modalEnd.classList.remove('show'); });

  // ---------- Inicio ----------
  reset(false);
  modalHow.classList.add('show');
  </script>
</body>
</html>